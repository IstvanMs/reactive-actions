<div style="margin-bottom: 30px;">
  <h2>Rate Limiting Testing</h2>
  <p style="color: #6c757d; margin-bottom: 20px;">
    Test the ReactiveActions rate limiting functionality with different configurations and scenarios.
  </p>

  <!-- Rate Limiting Configuration -->
  <div style="background: #e7f3ff; border: 1px solid #b8daff; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
    <h3>Rate Limiting Configuration</h3>
    <p style="margin-bottom: 15px; color: #004085;">
      Configure rate limiting settings for testing:
    </p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
      <div>
        <label for="rateLimitEnabled" style="display: block; margin-bottom: 5px; font-weight: bold;">
          <input type="checkbox" id="rateLimitEnabled" checked> Enable Rate Limiting
        </label>
      </div>
      <div>
        <label for="globalRateLimitEnabled" style="display: block; margin-bottom: 5px; font-weight: bold;">
          <input type="checkbox" id="globalRateLimitEnabled"> Enable Global Rate Limiting
        </label>
      </div>
      <div>
        <label for="testLimit" style="display: block; margin-bottom: 5px; font-weight: bold;">Test Limit:</label>
        <input 
          type="number" 
          id="testLimit" 
          value="5" 
          min="1" 
          max="100"
          style="width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px;"
        />
      </div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
      <div>
        <label for="testWindow" style="display: block; margin-bottom: 5px; font-weight: bold;">Test Window (seconds):</label>
        <input 
          type="number" 
          id="testWindow" 
          value="60" 
          min="1" 
          max="3600"
          style="width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px;"
        />
      </div>
      <div>
        <label for="testKey" style="display: block; margin-bottom: 5px; font-weight: bold;">Test Key:</label>
        <input 
          type="text" 
          id="testKey" 
          value="test_user"
          placeholder="e.g., user:123, api:endpoint"
          style="width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px;"
        />
      </div>
    </div>
    
    <button onclick="RateLimitTesting.applyConfiguration()" 
            style="background: #007cba; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">
      Apply Configuration
    </button>
  </div>

  <!-- Verification Tests Section -->
  <div style="background: #f0f8f0; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
    <h3>Rate Limiting Verification Tests</h3>
    <p style="color: #155724; margin-bottom: 15px;">
      These tests verify that rate limiting works correctly by checking both positive and negative scenarios.
    </p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
      <button onclick="RateLimitTesting.testRateLimitTriggering()" 
              style="background: #dc3545; color: white; padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer;">
        ðŸŽ¯ Test Rate Limit Triggering
      </button>
      
      <button onclick="RateLimitTesting.testRateLimitNotTriggering()" 
              style="background: #28a745; color: white; padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer;">
        ðŸŽ¯ Test Rate Limit NOT Triggering
      </button>
      
      <button onclick="RateLimitTesting.testDisabledRateLimitingVerification()" 
              style="background: #6c757d; color: white; padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer;">
        ðŸš« Test Disabled Verification
      </button>
      
      <button onclick="RateLimitTesting.testRateLimitResetVerification()" 
              style="background: #fd7e14; color: white; padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer;">
        ðŸ”„ Test Reset Verification
      </button>
    </div>
    
    <div style="text-align: center;">
      <button onclick="RateLimitTesting.runComprehensiveTests()" 
              style="background: #6f42c1; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 16px;">
        ðŸš€ Run Comprehensive Verification Suite
      </button>
    </div>
  </div>

  <!-- Rate Limit Test Scenarios -->
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
    
    <!-- Basic Rate Limiting Tests -->
    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px;">
      <h4>Basic Rate Limiting</h4>
      <p style="color: #6c757d; font-size: 14px; margin-bottom: 10px;">
        Test basic rate limit functionality
      </p>
      
      <div style="display: flex; flex-direction: column; gap: 8px;">
        <button onclick="RateLimitTesting.testRateLimit()" 
                style="background: #28a745; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Test Rate Limit
        </button>
        
        <button onclick="RateLimitTesting.testRateLimitWithCost()" 
                style="background: #17a2b8; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Test with Custom Cost
        </button>
        
        <button onclick="RateLimitTesting.testMultipleRequests()" 
                style="background: #ffc107; color: #212529; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Test Multiple Requests
        </button>
      </div>
    </div>

    <!-- Rate Limit Status Tests -->
    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px;">
      <h4>Status & Management</h4>
      <p style="color: #6c757d; font-size: 14px; margin-bottom: 10px;">
        Check status and manage limits
      </p>
      
      <div style="display: flex; flex-direction: column; gap: 8px;">
        <button onclick="RateLimitTesting.checkStatus()" 
                style="background: #6f42c1; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Check Status
        </button>
        
        <button onclick="RateLimitTesting.checkWouldExceed()" 
                style="background: #fd7e14; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Check Would Exceed
        </button>
        
        <button onclick="RateLimitTesting.resetRateLimit()" 
                style="background: #dc3545; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Reset Rate Limit
        </button>
      </div>
    </div>

    <!-- Different Keys Test -->
    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px;">
      <h4>Multiple Keys Testing</h4>
      <p style="color: #6c757d; font-size: 14px; margin-bottom: 10px;">
        Test rate limiting with different keys
      </p>
      
      <div style="display: flex; flex-direction: column; gap: 8px;">
        <button onclick="RateLimitTesting.testDifferentKeys()" 
                style="background: #e83e8c; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Test Different Keys
        </button>
        
        <button onclick="RateLimitTesting.testScopedKeys()" 
                style="background: #20c997; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Test Scoped Keys
        </button>
        
        <button onclick="RateLimitTesting.testUserKeys()" 
                style="background: #6c757d; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Test User-Based Keys
        </button>
      </div>
    </div>

    <!-- Advanced Scenarios -->
    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px;">
      <h4>Advanced Scenarios</h4>
      <p style="color: #6c757d; font-size: 14px; margin-bottom: 10px;">
        Test complex rate limiting scenarios
      </p>
      
      <div style="display: flex; flex-direction: column; gap: 8px;">
        <button onclick="RateLimitTesting.testDisabledRateLimiting()" 
                style="background: #6c757d; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Test Disabled State
        </button>
        
        <button onclick="RateLimitTesting.testRapidRequests()" 
                style="background: #dc3545; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Test Rapid Requests
        </button>
        
        <button onclick="RateLimitTesting.testTimeWindowExpiry()" 
                style="background: #fd7e14; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;">
          Test Window Expiry
        </button>
      </div>
    </div>

    <!-- Batch Testing -->
    <div style="background: #e7f3ff; border: 1px solid #b8daff; border-radius: 8px; padding: 15px; grid-column: span 2;">
      <h4>Batch Testing</h4>
      <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
        <button onclick="RateLimitTesting.runAllTests()" 
                style="background: #007cba; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
          Run All Basic Tests
        </button>
        
        <button onclick="RateLimitTesting.clearAllResults()" 
                style="background: #6c757d; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer;">
          Clear All Results
        </button>
        
        <div style="margin-left: auto;">
          <label style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="autoRefreshStatus"> Auto-refresh Status
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Current Status Display -->
  <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
    <h4>Current Rate Limit Status</h4>
    <div id="currentStatus" style="font-family: monospace; background: #fff; padding: 10px; border: 1px solid #ccc; border-radius: 4px; min-height: 60px; white-space: pre-wrap;">
      Click "Check Status" to view current rate limit information...
    </div>
  </div>
  
  <!-- Test Explanation -->
  <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
    <h4>How Rate Limiting Verification Works</h4>
    <ul style="margin: 10px 0; padding-left: 20px;">
      <li><strong>Triggering Test:</strong> Makes exactly the limit number of requests (should succeed), then additional requests (should be rate limited)</li>
      <li><strong>NOT Triggering Test:</strong> Makes requests under the limit (all should succeed)</li>
      <li><strong>Disabled Test:</strong> Makes many requests with rate limiting disabled (all should succeed)</li>
      <li><strong>Reset Test:</strong> Fills rate limit, verifies it's blocked, resets, then verifies it works again</li>
      <li><strong>Error Classification:</strong> Distinguishes between rate limit errors and other types of errors</li>
    </ul>
  </div>
</div>

<div>
  <h2>Rate Limiting Test Results</h2>
  <pre id="rateLimitResults" style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; border-radius: 4px; overflow-x: auto; overflow-y: auto; min-height: 200px; max-height: 600px; white-space: pre-wrap; word-wrap: break-word;">
Rate limiting test results will appear here...
  </pre>
  <button onclick="RateLimitTesting.clearResults()" style="background: #6c757d; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">
    Clear Results
  </button>
</div>

<%= javascript_include_tag 'rate_limit_testing' %>